<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Draw King</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Space Grotesk', sans-serif;
        background-color: #0f0518;
        color: #e2e8f0;
        overflow-x: hidden;
      }
      .glass {
        background: rgba(30, 20, 50, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .glow-text {
        text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
      }
      .glow-gold {
        text-shadow: 0 0 10px rgba(250, 204, 21, 0.5);
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0f0518;
      }
      ::-webkit-scrollbar-thumb {
        background: #4c1d95;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6d28d9;
      }
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
      }
      .animate-float {
        animation: float 4s ease-in-out infinite;
      }
      
      /* Gacha Animations */
      @keyframes shake-gold {
        0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1.1); filter: brightness(1); }
        25% { transform: translate(-2px, 2px) rotate(-2deg) scale(1.15); filter: brightness(1.2); }
        50% { transform: translate(2px, -2px) rotate(2deg) scale(1.2); filter: brightness(1.5) drop-shadow(0 0 25px gold); }
        75% { transform: translate(-2px, -2px) rotate(-2deg) scale(1.15); filter: brightness(1.2); }
      }
      .animate-shake-gold {
        animation: shake-gold 0.5s cubic-bezier(.36,.07,.19,.97) infinite;
      }

      @keyframes pulse-purple {
        0%, 100% { transform: scale(1); filter: brightness(1); box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4); }
        50% { transform: scale(1.05); filter: brightness(1.3); box-shadow: 0 0 30px 10px rgba(168, 85, 247, 0.6); }
      }
      .animate-pulse-purple {
        animation: pulse-purple 0.6s ease-in-out infinite;
      }

      @keyframes pulse-blue {
        0%, 100% { transform: scale(1); filter: brightness(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
        50% { transform: scale(1.02); filter: brightness(1.1); box-shadow: 0 0 20px 5px rgba(59, 130, 246, 0.4); }
      }
      .animate-pulse-blue {
        animation: pulse-blue 1.2s ease-in-out infinite;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useCallback, useMemo, useRef } = React;

      // ==========================================
      // *** CONFIGURATION ***
      // ==========================================
      
      // ---------------------------------------------------------
      // üëá EDIT THIS SINGLE VALUE TO CHANGE GAME DIFFICULTY üëá
      // ---------------------------------------------------------
      const BASE_TARGET_EV = 1.0; 
      // ---------------------------------------------------------
      // 0.95 means for every 100 draws spent, player gets back 95 on average.
      // < 1.0 = Hard (House Wins)
      // > 1.0 = Easy (Player Wins)
      // ---------------------------------------------------------

      // Rarity Shape (Higher alpha = rarer high rewards)
      // w = 1 / r^alpha
      const RARITY_ALPHA = 1.8; 
      
      // Fixed Reward Tiers (Do not change)
      const POSITIVE_REWARDS = [1, 3, 5, 10];
      
      // ==========================================
      // CONSTANTS & TYPES
      // ==========================================

      const Rarity = {
        COMMON: 'COMMON', // 0, 1, 3
        RARE: 'RARE',     // 5
        LEGENDARY: 'LEGENDARY' // 10
      };

      const RARITY_COLORS = {
        [Rarity.COMMON]: 'text-blue-400 border-blue-400/30 bg-blue-500/10 shadow-blue-500/20',
        [Rarity.RARE]: 'text-purple-400 border-purple-400/30 bg-purple-500/10 shadow-purple-500/20',
        [Rarity.LEGENDARY]: 'text-yellow-400 border-yellow-400/30 bg-yellow-500/10 shadow-yellow-500/20',
      };

      const BASE_FREE_DRAW_INTERVAL = 60;
      const MIN_FREE_DRAW_INTERVAL = 10;

      const RANKS = [
        { threshold: 0, title: "Beggar" },
        { threshold: 10, title: "Rookie Roller" },
        { threshold: 25, title: "Coin Flipper" },
        { threshold: 50, title: "Slot Squire" },
        { threshold: 100, title: "Dice Dealer" },
        { threshold: 200, title: "Pit Boss" },
        { threshold: 350, title: "High Roller" },
        { threshold: 500, title: "Jackpot Baron" },
        { threshold: 750, title: "Royal Gambler" },
        { threshold: 1000, title: "Immortal Draw King" },
        { threshold: 1500, title: "Mythic House" },
        { threshold: 2500, title: "Gacha God" },
        { threshold: 5000, title: "Entropy Master" },
      ];

      const AVAILABLE_BUFFS = [
        {
          id: 'luck_boost',
          name: 'Fortune\'s Favor',
          description: 'Increases EV to 1.15 (More wins) for 2 minutes.',
          durationSeconds: 120,
          cost: 50,
          icon: '‚ú®',
          type: 'LUCK'
        },
        {
          id: 'speed_upgrade',
          name: 'Time Warp',
          description: 'Permanently reduce time for free draw by 1s (Max -50s).',
          durationSeconds: 0,
          cost: 10,
          icon: '‚è≥',
          type: 'SPEED'
        },
        {
          id: 'double_reward',
          name: 'Double Down',
          description: '10% chance to double any positive draw reward for 60 seconds.',
          durationSeconds: 60,
          cost: 30,
          icon: 'üé≤',
          type: 'DOUBLE'
        },
        {
          id: 'streak_shield',
          name: 'Safety Net',
          description: 'Converts a +0 result into a +1 (once per minute) for 2 minutes.',
          durationSeconds: 120,
          cost: 25,
          icon: 'üõ°Ô∏è',
          type: 'SHIELD'
        }
      ];

      // ==========================================
      // LOGIC: MATH ENGINE (EV CALCULATOR)
      // ==========================================

      const calculateTable = (targetEV, alpha) => {
        // 1. Calculate Weights for Positive Rewards
        // w(r) = 1 / r^alpha
        const weights = POSITIVE_REWARDS.map(r => 1 / Math.pow(r, alpha));
        const sumWeights = weights.reduce((a, b) => a + b, 0);

        // 2. Normalize to Conditional Probabilities (q_i)
        // Probability of getting r_i GIVEN that you get > 0
        const conditionalProbs = weights.map(w => w / sumWeights);

        // 3. Compute Mu (Average Non-Zero Reward)
        const mu = POSITIVE_REWARDS.reduce((sum, r, i) => sum + (r * conditionalProbs[i]), 0);

        // 4. Compute Scaling Factor S (Total probability of winning > 0)
        // EV = S * mu + (1-S) * 0  =>  S = EV / mu
        // Clamp S to 0.99 to ensure there is always a tiny chance of failure unless EV is impossibly high
        let S = targetEV / mu;
        if (S > 0.99) S = 0.99; 

        // 5. Final Probabilities
        const pPositive = conditionalProbs.map(q => q * S);
        const pZero = 1 - S;

        // Construct Table
        const table = [
          { reward: 0, p: pZero },
          ...POSITIVE_REWARDS.map((r, i) => ({ reward: r, p: pPositive[i] }))
        ];

        return { table, S };
      };

      // ==========================================
      // COMPONENTS
      // ==========================================

      const HistoryLog = ({ history }) => {
        return (
          <div className="glass rounded-xl p-4 h-full flex flex-col w-full lg:w-80 flex-shrink-0">
            <h3 className="text-gray-400 text-xs font-bold uppercase tracking-widest mb-4 border-b border-white/10 pb-2">
              Pull History
            </h3>
            <div className="flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar">
              {history.length === 0 && (
                <div className="text-center text-gray-600 text-sm py-4">No draws yet...</div>
              )}
              {history.map((item) => (
                <div
                  key={item.id}
                  className={`flex items-center justify-between p-2 rounded-lg border ${RARITY_COLORS[item.rarity]} border-opacity-30`}
                >
                  <div className="flex items-center gap-2">
                    <span className={`text-lg ${item.amount > 0 ? 'text-white' : 'text-gray-500'}`}>
                      {item.amount > 0 ? `+${item.amount}` : '+0'}
                    </span>
                    {item.wasDoubled && <span className="text-xs bg-yellow-500 text-black px-1 rounded font-bold">x2</span>}
                    {item.wasShielded && <span className="text-xs bg-blue-500 text-white px-1 rounded">üõ°Ô∏è</span>}
                  </div>
                  <span className="text-xs opacity-50 font-mono">
                     {new Date(item.timestamp).toLocaleTimeString([], { hour12: false, minute: '2-digit', second:'2-digit' })}
                  </span>
                </div>
              ))}
            </div>
          </div>
        );
      };

      const StorePanel = ({ currentDraws, activeBuffs, onBuy, speedUpLevel }) => {
        const isBuffActive = (buffId) => activeBuffs.some(b => b.id === buffId);

        return (
          <div className="glass rounded-xl p-6 w-full mt-6">
            <div className="flex items-center justify-between mb-4 border-b border-white/10 pb-2">
              <h3 className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                The Vault
              </h3>
              <span className="text-xs text-gray-400 uppercase">Spend Draws ‚Ä¢ Get Power</span>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              {AVAILABLE_BUFFS.map(buff => {
                const isActive = isBuffActive(buff.id);
                const canAfford = currentDraws >= buff.cost;
                const isSpeedUp = buff.type === 'SPEED';
                
                let buttonText = "Purchase";
                if (isActive && !isSpeedUp) buttonText = "Active";
                if (!canAfford) buttonText = "Need Draws";

                return (
                  <div key={buff.id} className="relative group bg-gray-900/50 border border-white/5 rounded-lg p-4 hover:border-purple-500/50 transition-all duration-300">
                    {isActive && !isSpeedUp && (
                      <div className="absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    )}
                    
                    <div className="flex items-center gap-3 mb-3">
                      <div className="text-3xl">{buff.icon}</div>
                      <div>
                        <h4 className="font-bold text-white leading-none">{buff.name}</h4>
                        <div className="flex items-center text-yellow-400 text-sm mt-1 font-mono">
                          <span className="mr-1">‚ô¶</span> {buff.cost}
                        </div>
                      </div>
                    </div>
                    
                    <p className="text-xs text-gray-400 mb-4 min-h-[40px] leading-relaxed">
                      {buff.description}
                      {isSpeedUp && <span className="block mt-1 text-purple-300">Level: {speedUpLevel}</span>}
                    </p>

                    <button
                      onClick={() => onBuy(buff)}
                      disabled={!canAfford || (isActive && !isSpeedUp)}
                      className={`w-full py-2 px-3 rounded text-sm font-bold uppercase tracking-wider transition-all
                        ${!canAfford 
                          ? 'bg-gray-800 text-gray-500 cursor-not-allowed' 
                          : (isActive && !isSpeedUp)
                            ? 'bg-green-900/50 text-green-400 border border-green-500/30 cursor-default'
                            : 'bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white shadow-lg shadow-purple-900/20 active:scale-95'
                        }`}
                    >
                      {buttonText}
                    </button>
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      const SummonModal = ({ results, onClose }) => {
        const [revealedCount, setRevealedCount] = useState(0);

        useEffect(() => {
          if (revealedCount < results.length) {
            const timer = setTimeout(() => {
              setRevealedCount(prev => prev + 1);
            }, 150);
            return () => clearTimeout(timer);
          }
        }, [revealedCount, results.length]);

        const highestRarity = results.some(r => r.rarity === Rarity.LEGENDARY) 
          ? Rarity.LEGENDARY 
          : results.some(r => r.rarity === Rarity.RARE)
            ? Rarity.RARE
            : Rarity.COMMON;

        const glowColor = highestRarity === Rarity.LEGENDARY ? 'shadow-yellow-500/20' : highestRarity === Rarity.RARE ? 'shadow-purple-500/20' : 'shadow-blue-500/20';
        const borderColor = highestRarity === Rarity.LEGENDARY ? 'border-yellow-500/50' : highestRarity === Rarity.RARE ? 'border-purple-500/50' : 'border-blue-500/50';

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-200">
            <div className={`relative w-full max-w-2xl bg-[#1a102e] rounded-2xl p-8 border-2 ${borderColor} shadow-2xl ${glowColor}`}>
              
              <div className="text-center mb-8 relative">
                <h2 className="text-3xl font-bold text-white uppercase tracking-widest glow-text">
                  Summon Complete
                </h2>
              </div>

              <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                {results.map((res, idx) => (
                  <div 
                    key={res.id}
                    className={`
                      aspect-square flex flex-col items-center justify-center rounded-xl border-2 transition-all duration-500
                      ${idx < revealedCount ? 'opacity-100 scale-100 rotate-0' : 'opacity-0 scale-50 rotate-12'}
                      ${RARITY_COLORS[res.rarity]}
                    `}
                  >
                    <div className="text-2xl font-bold mb-1">
                      {res.amount > 0 ? `+${res.amount}` : '0'}
                    </div>
                    <div className="text-[10px] uppercase font-bold opacity-75">
                      {res.rarity === Rarity.LEGENDARY ? 'LEGEND' : res.rarity}
                    </div>
                  </div>
                ))}
              </div>

              <div className="flex justify-center">
                <button 
                  onClick={onClose}
                  className="px-8 py-3 bg-white text-black font-bold uppercase tracking-widest rounded hover:bg-gray-200 hover:scale-105 transition-all"
                >
                  Collect
                </button>
              </div>
            </div>
          </div>
        );
      };

      // ==========================================
      // MAIN APP LOGIC
      // ==========================================

      const INITIAL_STATE = {
        draws: 10,
        highestDraws: 10,
        history: [],
        activeBuffs: [],
        speedUpLevel: 0,
        lastFreeDrawTime: Date.now(),
        timeToNextDraw: BASE_FREE_DRAW_INTERVAL,
        stats: { totalPulls: 0, totalEarned: 10 }
      };

      const App = () => {
        const [gameState, setGameState] = useState(() => {
          const saved = localStorage.getItem('drawKingSave');
          return saved ? JSON.parse(saved) : INITIAL_STATE;
        });

        const [skipAnimation, setSkipAnimation] = useState(false);
        const [isPulling, setIsPulling] = useState(false);
        const [animationState, setAnimationState] = useState('IDLE');
        const [summonResults, setSummonResults] = useState(null);
        
        // Calculate Probabilities based on current State
        // If "LUCK" buff is active, we increase the Target EV
        const activeEV = useMemo(() => {
            const hasLuck = gameState.activeBuffs.some(b => b.type === 'LUCK');
            return hasLuck ? 1.15 : BASE_TARGET_EV;
        }, [gameState.activeBuffs]);

        const mathData = useMemo(() => {
            return calculateTable(activeEV, RARITY_ALPHA);
        }, [activeEV]);

        useEffect(() => {
          localStorage.setItem('drawKingSave', JSON.stringify(gameState));
        }, [gameState]);

        const getCurrentRank = useCallback((highScore) => {
          const rank = [...RANKS].reverse().find(r => highScore >= r.threshold);
          return rank || RANKS[0];
        }, []);

        const getInterval = useCallback(() => {
          const reduced = BASE_FREE_DRAW_INTERVAL - gameState.speedUpLevel;
          return Math.max(MIN_FREE_DRAW_INTERVAL, reduced);
        }, [gameState.speedUpLevel]);

        useEffect(() => {
          const timer = setInterval(() => {
            setGameState(prev => {
              const now = Date.now();
              const currentInterval = Math.max(MIN_FREE_DRAW_INTERVAL, BASE_FREE_DRAW_INTERVAL - prev.speedUpLevel);
              
              let newTimeToNext = prev.timeToNextDraw - 1;
              let newDraws = prev.draws;
              let newLastFree = prev.lastFreeDrawTime;
              let newHighest = prev.highestDraws;

              if (newTimeToNext <= 0) {
                newDraws += 1;
                newHighest = Math.max(newHighest, newDraws);
                newTimeToNext = currentInterval;
                newLastFree = now;
              }

              const validBuffs = prev.activeBuffs.filter(b => 
                b.durationSeconds === 0 || (b.expiresAt && b.expiresAt > now)
              );

              return {
                ...prev,
                draws: newDraws,
                highestDraws: newHighest,
                timeToNextDraw: newTimeToNext,
                lastFreeDrawTime: newLastFree,
                activeBuffs: validBuffs
              };
            });
          }, 1000);

          return () => clearInterval(timer);
        }, []);

        // Cost is the amount spent (1 or 10)
        // PullCount is how many RNG rolls happen (1 or 10)
        const performPull = useCallback((cost, pullCount) => {
          if (gameState.draws < cost) return;
          if (isPulling) return;

          setIsPulling(true);
          
          const results = [];
          const hasDouble = gameState.activeBuffs.some(b => b.type === 'DOUBLE');
          const hasShield = gameState.activeBuffs.some(b => b.type === 'SHIELD');

          let earnedDraws = 0;
          let maxRarityInBatch = 'COMMON';

          // Use pre-calculated table for RNG
          const table = mathData.table;
          // Create cumulative array for weighted choice
          const cumulative = [];
          let sum = 0;
          for(let row of table) {
              sum += row.p;
              cumulative.push({ limit: sum, reward: row.reward });
          }

          for (let i = 0; i < pullCount; i++) {
            const rng = Math.random(); // 0..1
            
            // Find reward based on probability table
            let amount = 0;
            for(let c of cumulative) {
                if(rng < c.limit) {
                    amount = c.reward;
                    break;
                }
            }
            // Fallback for floating point errors
            if (rng >= cumulative[cumulative.length-1].limit) {
                 amount = 0;
            }

            let rarity = amount >= 10 ? Rarity.LEGENDARY : amount >= 5 ? Rarity.RARE : Rarity.COMMON;

            let wasShielded = false;
            let wasDoubled = false;

            // Shield Logic
            if (amount === 0 && hasShield && Math.random() < 0.25) {
                amount = 1; wasShielded = true;
            }

            // Double Logic
            if (amount > 0 && hasDouble && Math.random() < 0.1) {
              amount *= 2; wasDoubled = true;
            }

            earnedDraws += amount;
            
            if (amount >= 10 && maxRarityInBatch !== 'LEGENDARY') maxRarityInBatch = 'LEGENDARY';
            else if (amount >= 5 && maxRarityInBatch !== 'LEGENDARY' && maxRarityInBatch !== 'RARE') maxRarityInBatch = 'RARE';

            results.push({
              id: Math.random().toString(36).substr(2, 9),
              amount,
              rarity: amount >= 10 ? Rarity.LEGENDARY : amount >= 5 ? Rarity.RARE : Rarity.COMMON,
              timestamp: Date.now(),
              wasDoubled,
              wasShielded
            });
          }

          setAnimationState(maxRarityInBatch);

          const delay = skipAnimation ? 100 : 1500;

          setTimeout(() => {
            setGameState(prev => {
              const newDraws = prev.draws - cost + earnedDraws;
              return {
                ...prev,
                draws: newDraws,
                highestDraws: Math.max(prev.highestDraws, newDraws),
                stats: {
                  totalPulls: prev.stats.totalPulls + pullCount,
                  totalEarned: prev.stats.totalEarned + earnedDraws
                },
                history: [...results.reverse(), ...prev.history].slice(0, 50)
              };
            });

            if (!skipAnimation) {
              setSummonResults(results);
            }
            setIsPulling(false);
            setAnimationState('IDLE');

          }, delay);
        }, [gameState.draws, gameState.activeBuffs, isPulling, skipAnimation, mathData]);

        const buyBuff = (buff) => {
          if (gameState.draws < buff.cost) return;

          setGameState(prev => {
            const active = [...prev.activeBuffs];
            let speedLevel = prev.speedUpLevel;

            if (buff.type === 'SPEED') {
              if (speedLevel < 50) speedLevel += 1;
              else return prev;
            } else {
              const existingIdx = active.findIndex(b => b.id === buff.id);
              const newBuff = { ...buff, expiresAt: Date.now() + (buff.durationSeconds * 1000) };
              if (existingIdx >= 0) active[existingIdx] = newBuff;
              else active.push(newBuff);
            }

            return {
              ...prev,
              draws: prev.draws - buff.cost,
              activeBuffs: active,
              speedUpLevel: speedLevel
            };
          });
        };

        const currentRank = getCurrentRank(gameState.highestDraws);

        const getOrbStyles = () => {
          if (!isPulling) return 'animate-float bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-500 shadow-[0_0_50px_rgba(168,85,247,0.4)]';
          
          switch (animationState) {
            case 'LEGENDARY':
              return 'animate-shake-gold bg-gradient-to-br from-yellow-400 via-orange-500 to-yellow-600 shadow-[0_0_80px_rgba(234,179,8,0.8)] border-4 border-yellow-200';
            case 'RARE':
              return 'animate-pulse-purple bg-gradient-to-br from-purple-600 via-fuchsia-600 to-purple-800 shadow-[0_0_60px_rgba(192,38,211,0.6)] border-2 border-purple-300';
            default: 
              return 'animate-pulse-blue bg-gradient-to-br from-blue-500 via-indigo-600 to-blue-700 shadow-[0_0_50px_rgba(59,130,246,0.5)]';
          }
        };

        const getOrbContent = () => {
          if (!isPulling) return <div className="text-6xl filter drop-shadow-lg">üíé</div>;
          return <div className="text-6xl filter drop-shadow-lg transition-all duration-300 scale-110">
             {animationState === 'LEGENDARY' ? 'üåü' : animationState === 'RARE' ? '‚ú®' : 'üåÄ'}
          </div>;
        };

        return (
          <div className="min-h-screen flex flex-col relative pb-10">
            <div className="fixed inset-0 pointer-events-none overflow-hidden">
              <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-900/20 rounded-full blur-[100px]" />
              <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900/20 rounded-full blur-[100px]" />
            </div>

            <header className="sticky top-0 z-40 glass border-b border-white/10 px-4 py-3 shadow-lg">
              <div className="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
                <div className="flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-start">
                  <h1 className="text-2xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                    DRAW KING
                  </h1>
                  <div className="flex items-center gap-2 bg-black/40 px-3 py-1 rounded-full border border-white/5">
                    <span className="text-gray-400 text-xs font-bold uppercase">Rank</span>
                    <span className="text-yellow-400 font-bold text-sm glow-gold">{currentRank.title}</span>
                  </div>
                </div>

                <div className="flex items-center gap-6">
                  <div className="text-center">
                    <div className="text-xs text-gray-500 font-bold uppercase tracking-wider">Balance</div>
                    <div className="text-3xl font-mono font-bold text-white leading-none glow-text">
                      {gameState.draws}
                    </div>
                  </div>
                  <div className="h-8 w-px bg-white/10 hidden sm:block"></div>
                  <div className="text-center hidden sm:block">
                    <div className="text-xs text-gray-500 font-bold uppercase tracking-wider">Record</div>
                    <div className="text-lg font-mono text-gray-300 leading-none">
                      {gameState.highestDraws}
                    </div>
                  </div>
                </div>

                <div className="flex items-center gap-3">
                  <div className="relative group overflow-visible w-10 h-10">
                    <svg className="w-full h-full -rotate-90 drop-shadow-md" viewBox="0 0 44 44">
                       <circle cx="22" cy="22" r="18" stroke="rgba(255,255,255,0.1)" strokeWidth="4" fill="transparent" />
                       <circle cx="22" cy="22" r="18" stroke="currentColor" strokeWidth="4" fill="transparent" 
                          className="text-purple-500 transition-all duration-1000 ease-linear"
                          strokeDasharray={113.1}
                          strokeDashoffset={113.1 - (gameState.timeToNextDraw / getInterval()) * 113.1}
                          strokeLinecap="round" 
                       />
                    </svg>
                    <span className="absolute inset-0 flex items-center justify-center text-xs font-bold pointer-events-none">
                      {gameState.timeToNextDraw}
                    </span>
                    <div className="absolute top-10 right-0 bg-black/90 p-2 rounded text-xs whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none border border-white/10 z-50">
                      Next free draw in {gameState.timeToNextDraw}s
                    </div>
                  </div>
                </div>
              </div>
            </header>

            <div className="flex-1 max-w-7xl mx-auto w-full p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
              
              <div className="lg:col-span-8 flex flex-col items-center">
                
                {gameState.activeBuffs.length > 0 && (
                  <div className="w-full flex gap-3 mb-6 overflow-x-auto pb-2 custom-scrollbar min-h-[60px]">
                    {gameState.activeBuffs.map(buff => {
                       const timeLeft = buff.expiresAt ? Math.ceil((buff.expiresAt - Date.now()) / 1000) : null;
                       if (timeLeft !== null && timeLeft <= 0) return null;
                       
                       return (
                        <div key={buff.id} className="flex items-center gap-2 bg-purple-900/20 border border-purple-500/30 rounded-full px-4 py-1.5 whitespace-nowrap animate-in fade-in slide-in-from-bottom-2">
                          <span>{buff.icon}</span>
                          <span className="text-sm font-bold text-purple-200">{buff.name}</span>
                          {timeLeft && <span className="text-xs font-mono text-purple-400 w-8">{timeLeft}s</span>}
                        </div>
                       );
                    })}
                  </div>
                )}

                <div className="relative w-full max-w-xl min-h-[420px] bg-black/30 rounded-3xl border border-white/5 flex flex-col items-center justify-center p-10 mb-8 group overflow-visible">
                   <div className="absolute inset-0 rounded-3xl overflow-hidden pointer-events-none z-0">
                       <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-900/20 via-transparent to-transparent opacity-50"></div>
                   </div>
                   
                   <div className={`relative z-10 w-48 h-48 rounded-full flex items-center justify-center mb-8 transition-all duration-300 ${getOrbStyles()}`}>
                     {getOrbContent()}
                     
                     {animationState !== 'LEGENDARY' && (
                       <>
                        <div className="absolute inset-0 border-4 border-white/20 rounded-full animate-[spin_10s_linear_infinite]"></div>
                        <div className="absolute -inset-4 border border-white/10 rounded-full animate-[spin_15s_linear_infinite_reverse]"></div>
                       </>
                     )}
                   </div>

                   <div className="flex flex-col sm:flex-row gap-4 w-full max-w-md z-20">
                      <button
                        onClick={() => performPull(1, 1)}
                        disabled={gameState.draws < 1 || isPulling}
                        className="flex-1 relative group overflow-hidden bg-gray-800 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed border border-white/10 rounded-xl p-4 transition-all active:scale-95"
                      >
                        <div className="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-transparent translate-x-[-100%] group-hover:translate-x-100 transition-transform duration-700"></div>
                        <div className="relative flex flex-col items-center">
                          <span className="font-bold text-lg">Summon x1</span>
                          <span className="text-xs text-blue-300 mt-1">Cost: 1 Draw</span>
                        </div>
                      </button>

                      <button
                        onClick={() => performPull(10, 10)}
                        disabled={gameState.draws < 10 || isPulling}
                        className="flex-1 relative group overflow-hidden bg-gradient-to-br from-purple-900 to-indigo-900 hover:from-purple-800 hover:to-indigo-800 disabled:opacity-50 disabled:cursor-not-allowed border border-purple-500/30 rounded-xl p-4 transition-all shadow-lg shadow-purple-900/20 active:scale-95"
                      >
                        <div className="absolute inset-0 bg-gradient-to-r from-yellow-400/20 to-transparent translate-x-[-100%] group-hover:translate-x-100 transition-transform duration-700"></div>
                        <div className="relative flex flex-col items-center">
                          <div className="flex items-center gap-1">
                            <span className="font-bold text-lg glow-gold text-yellow-100">Summon x10</span>
                          </div>
                          <span className="text-xs text-yellow-300 mt-1">Cost: 10 Draws</span>
                        </div>
                      </button>
                   </div>

                   <button 
                      onClick={() => setSkipAnimation(!skipAnimation)}
                      className="mt-6 flex items-center gap-3 px-5 py-2.5 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 transition-all z-20 group active:scale-95 cursor-pointer"
                   >
                      <div className={`w-5 h-5 rounded flex items-center justify-center transition-all duration-300 ${skipAnimation ? 'bg-blue-500 shadow-lg shadow-blue-500/40 scale-110' : 'bg-black/40 border-2 border-white/20 group-hover:border-white/40'}`}>
                          {skipAnimation && (
                              <svg className="w-3.5 h-3.5 text-white stroke-current" viewBox="0 0 24 24" fill="none" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round">
                                  <polyline points="20 6 9 17 4 12"></polyline>
                              </svg>
                          )}
                      </div>
                      <span className={`text-sm font-bold tracking-wide transition-colors ${skipAnimation ? 'text-white' : 'text-gray-400 group-hover:text-gray-300'}`}>
                          Skip Animations
                      </span>
                   </button>
                </div>

                <StorePanel 
                  currentDraws={gameState.draws} 
                  activeBuffs={gameState.activeBuffs} 
                  onBuy={buyBuff}
                  speedUpLevel={gameState.speedUpLevel}
                />

              </div>

              <div className="lg:col-span-4 h-[500px] lg:h-auto lg:sticky lg:top-24">
                <HistoryLog history={gameState.history} />
              </div>

            </div>

            {summonResults && (
              <SummonModal 
                results={summonResults} 
                onClose={() => setSummonResults(null)} 
              />
            )}

          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>